#! /bin/bash

#
# This script creates the setup.sh script for the `common` directory.
# Usage:
#   > ./create_common_setup.sh
#

mkdir -p $COMMON_BUILD_PREFIX
chmod -R 777 $COMMON_BUILD_PREFIX/..
cd $COMMON_BUILD_PREFIX
echo "# This file is automatically generated by luna_dependencies/Scripts/create_common_setup.sh." > setup.sh
# Includes a one-time-use-only guard to avoid repeatedly adding to these environment variables.
echo '[ -n "$P8COMPUTE_COMMON_SETUP" ] && return || readonly P8COMPUTE_COMMON_SETUP=1' >> setup.sh
echo "export COMMON_TAG=$COMMON_TAG" >> setup.sh
echo "export COMMON_BUILD_PREFIX=$COMMON_BUILD_PREFIX" >> setup.sh
# creation of the "current" link is not required, and cannot be done in a singularity container
echo 'ln -sfT $COMMON_BUILD_PREFIX $COMMON_BUILD_PREFIX/../current || true' >> setup.sh
echo 'export PATH=$COMMON_BUILD_PREFIX/bin:$PATH' >> setup.sh
echo 'export LD_LIBRARY_PATH=$COMMON_BUILD_PREFIX/lib:$LD_LIBRARY_PATH' >> setup.sh
echo 'source /usr/local/root/bin/thisroot.sh' >> setup.sh
